<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnival - ุจุงุฒ ูุงูุง ุชุงู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-image: url('https://i.postimg.cc/LqsDBbN7/image.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .content-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(1px);
        }
        .menu-slide {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .menu-slide.open {
            transform: translateX(0);
        }
        .joker-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin: 0 auto 20px;
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
        }
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }
    </style>
</head>
<body class="min-h-screen text-white font-sans">
    <div class="content-overlay min-h-screen">
        <!-- Header -->
        <header class="flex justify-between items-center p-4 bg-black bg-opacity-70">
            <div class="flex items-center space-x-4 space-x-reverse">
                <h1 class="text-4xl font-bold text-red-500 drop-shadow-lg">๐ญ Carnival</h1>
                <div id="liveStatus" class="flex items-center space-x-2 space-x-reverse bg-green-600 px-3 py-1 rounded-full text-sm font-bold">
                    <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
                    <span>ุขููุงู</span>
                </div>
            </div>
            <button id="menuBtn" class="text-3xl hover:text-red-500 transition-colors duration-300 hover:scale-110">โฐ</button>
        </header>

        <!-- Side Menu -->
        <div id="sideMenu" class="fixed top-0 right-0 h-full w-80 bg-black bg-opacity-95 menu-slide z-50 border-l-2 border-red-500">
            <div class="p-6">
                <button id="closeMenu" class="text-3xl float-left hover:text-red-500 transition-colors duration-300 hover:rotate-90">โ</button>
                <div class="clear-both mt-12">
                    <div id="menuItems" class="space-y-3">
                        <button onclick="showSection('home')" class="block w-full text-right p-4 hover:bg-red-600 rounded-lg transition-all duration-300 text-lg font-semibold">
                            ๐ ุฎุงูู
                        </button>
                        <button onclick="showSection('login')" class="block w-full text-right p-4 hover:bg-red-600 rounded-lg transition-all duration-300 text-lg font-semibold">
                            ๐ค ูุฑูุฏ ุจู ุญุณุงุจ ฺฉุงุฑุจุฑ
                        </button>
                        <button onclick="showSection('tutorials')" class="block w-full text-right p-4 hover:bg-red-600 rounded-lg transition-all duration-300 text-lg font-semibold">
                            ๐ ุขููุฒุด ูุงูุง
                        </button>
                        <button onclick="showSection('scenarios')" class="block w-full text-right p-4 hover:bg-red-600 rounded-lg transition-all duration-300 text-lg font-semibold">
                            ๐ฒ ุณูุงุฑููุง
                        </button>
                        <button onclick="showSection('groups')" class="block w-full text-right p-4 hover:bg-red-600 rounded-lg transition-all duration-300 text-lg font-semibold">
                            ๐ฅ ฺฏุฑููโูุง ูุงูุง ุชุงู
                        </button>
                        <div id="adminMenuItems" style="display: none;">
                            <button onclick="showSection('adminPanel')" class="block w-full text-right p-4 hover:bg-yellow-600 rounded-lg transition-all duration-300 text-lg font-semibold border-2 border-yellow-500">
                                โ๏ธ ูพูู ูุฏุฑุช
                            </button>
                        </div>
                        <button id="logoutBtn" onclick="logout()" class="block w-full text-right p-4 hover:bg-gray-600 rounded-lg transition-all duration-300 text-lg font-semibold" style="display: none;">
                            ๐ช ุฎุฑูุฌ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto p-6">
            <!-- Home Section -->
            <div id="homeSection" class="section">
                <div class="text-center mb-12">
                    <img src="https://i.postimg.cc/23v4NDJm/image.jpg" alt="ฺฉุงุฑูุงูุงู" class="w-32 h-32 mx-auto rounded-full mb-6 shadow-2xl border-4 border-red-500 object-cover">
                    <h2 class="text-5xl font-bold mb-6 text-red-400 drop-shadow-lg">ุจู ฺฉุงุฑูุงูุงู ุฎูุด ุขูุฏุฏ</h2>
                    <p class="text-2xl mb-8 text-gray-300">ุฏูุง ูุฌุงูโุงูฺฏุฒ ุจุงุฒ ูุงูุง</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                    <div class="bg-black bg-opacity-80 p-8 rounded-xl card-hover border border-red-500">
                        <h3 class="text-3xl font-bold mb-6 text-red-400 text-center">๐ฎ ูุงูุง ุชุงู</h3>
                        <div class="text-center mb-6">
                            <img src="https://i.postimg.cc/LqsDBbN7/image.jpg" alt="ูุงูุง ุชุงู" class="w-32 h-32 mx-auto rounded-full mb-6 shadow-2xl border-4 border-red-500 object-cover">
                            <p class="text-lg mb-6 leading-relaxed">ุจุงุฒ ูุงูุง ุชุงู ุฑุง ุฏุงูููุฏ ฺฉูุฏ ู ูุงุฑุฏ ุฏูุง ูุฌุงูโุงูฺฏุฒ ูุงูุง ุดูุฏ! ุงู ุจุงุฒ ุดูุง ุฑุง ุจู ุฏูุง ูพุฑ ุงุฒ ุฑุงุฒ ู ุฑูุฒ ูโุจุฑุฏ.</p>
                        </div>
                        <div class="text-center">
                            <a href="https://myket.ir/app/com.Sava.MafiaTime" target="_blank" 
                               class="inline-block bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 px-8 py-4 rounded-lg transition-all duration-300 text-lg font-bold shadow-lg hover:shadow-xl transform hover:scale-105">
                                ๐ฑ ุฏุงูููุฏ ุงุฒ ูุงฺฉุช
                            </a>
                        </div>
                    </div>

                    <div class="bg-black bg-opacity-80 p-8 rounded-xl card-hover border border-blue-500">
                        <h3 class="text-3xl font-bold mb-6 text-blue-400 text-center">๐ ูพุดุชุจุงู</h3>
                        <div class="text-center">
                            <img src="https://i.postimg.cc/fVWNkG29/image.jpg" alt="ูพุดุชุจุงู" class="w-32 h-32 mx-auto rounded-full mb-6 shadow-2xl border-4 border-blue-500 object-cover">
                            <p class="text-lg mb-6 leading-relaxed">ุจุฑุง ูุฑฺฏููู ุณูุงูุ ูุดฺฉู ุง ูพุดููุงุฏ ุจุง ูุง ุฏุฑ ุชูุงุณ ุจุงุดุฏ. ุชู ูพุดุชุจุงู ูุง ุขูุงุฏู ฺฉูฺฉ ุจู ุดูุงุณุช.</p>
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <p class="text-yellow-400 text-xl font-bold">v01409506@gmail.com</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Latest Content Display -->
                <div id="homeContentDisplay" class="mt-12">
                    <!-- Content will be loaded here -->
                </div>

                <div class="mt-12 text-center">
                    <div class="bg-black bg-opacity-80 p-8 rounded-xl max-w-4xl mx-auto border border-purple-500">
                        <div class="flex justify-between items-start mb-6">
                            <h3 class="text-3xl font-bold text-purple-400">๐ญ ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู</h3>
                            <div id="adminAboutControls" style="display: none;">
                                <button onclick="editAboutSection()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg font-bold transition-colors text-sm border-2 border-yellow-500">
                                    โ๏ธ ูุฑุงุด
                                </button>
                            </div>
                        </div>
                        <div id="aboutContent">
                            <p class="text-lg leading-relaxed text-gray-300">
                                ฺฉุงุฑูุงูุงู ฺฉ ูพูุชูุฑู ุฌุงูุน ุจุฑุง ุนูุงููโููุฏุงู ุจู ุจุงุฒ ูุงูุง ุงุณุช. ุฏุฑ ุงูุฌุง ูโุชูุงูุฏ ุขููุฒุดโูุง ฺฉุงููุ ุณูุงุฑููุง ูุชููุน ู ฺฏุฑููโูุง ูุฎุชูู ุจุงุฒ ุฑุง ูพุฏุง ฺฉูุฏ. 
                                ููฺูู ุงูฺฉุงู ุฏุงูููุฏ ุจุงุฒ ูุงูุง ุชุงู ู ุงุฑุชุจุงุท ุจุง ุณุงุฑ ุจุงุฒฺฉูุงู ุฑุง ุฏุงุฑุฏ.
                            </p>
                        </div>
                        <div id="aboutEditForm" style="display: none;" class="mt-6">
                            <textarea id="aboutTextEdit" rows="4" class="w-full p-4 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-purple-500 transition-colors"></textarea>
                            <div class="mt-4 space-x-2 space-x-reverse">
                                <button onclick="saveAboutSection()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-bold transition-colors">
                                    โ ุฐุฎุฑู
                                </button>
                                <button onclick="cancelAboutEdit()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg font-bold transition-colors">
                                    โ ูุบู
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Login Section -->
            <div id="loginSection" class="section hidden">
                <div class="max-w-lg mx-auto">
                    <div class="bg-black bg-opacity-90 p-10 rounded-xl border-2 border-red-500 shadow-2xl">
                        <div class="text-center mb-8">
                            <div class="joker-icon">๐ญ</div>
                            <h2 class="text-4xl font-bold text-red-400">ูุฑูุฏ ุจู ุญุณุงุจ</h2>
                        </div>
                        <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-6">
                            <div>
                                <label class="block text-lg font-bold mb-3 text-gray-300">ูุงู ฺฉุงุฑุจุฑ:</label>
                                <input type="text" id="username" required 
                                       class="w-full p-4 rounded-lg bg-gray-800 text-white border-2 border-gray-600 focus:border-red-500 transition-colors text-lg"
                                       placeholder="ูุงู ฺฉุงุฑุจุฑ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
                            </div>
                            <div>
                                <label class="block text-lg font-bold mb-3 text-gray-300">ุฑูุฒ ุนุจูุฑ:</label>
                                <input type="password" id="password" required 
                                       class="w-full p-4 rounded-lg bg-gray-800 text-white border-2 border-gray-600 focus:border-red-500 transition-colors text-lg"
                                       placeholder="ุฑูุฒ ุนุจูุฑ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">
                            </div>
                            <div>
                                <label class="block text-lg font-bold mb-3 text-gray-300">ูุงู ุฏุฑ ุจุงุฒ:</label>
                                <input type="text" id="gameName" required 
                                       class="w-full p-4 rounded-lg bg-gray-800 text-white border-2 border-gray-600 focus:border-red-500 transition-colors text-lg"
                                       placeholder="ูุงู ููุงุด ุฏุฑ ุจุงุฒ">
                            </div>
                            <button type="submit" 
                                    class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 p-4 rounded-lg font-bold transition-all duration-300 text-xl shadow-lg hover:shadow-xl transform hover:scale-105">
                                ูุฑูุฏ / ุซุจุช ูุงู
                            </button>
                        </form>
                        <div id="loginMessage" class="mt-6 text-center text-lg"></div>
                    </div>
                </div>
            </div>

            <!-- Tutorials Section -->
            <div id="tutorialsSection" class="section hidden">
                <div class="bg-black bg-opacity-90 p-8 rounded-xl border border-blue-500">
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-blue-400 mb-4">๐ ุขููุฒุด ุจุงุฒ ูุงูุง</h2>
                        <p class="text-lg text-gray-300">ููู ฺุฒ ุฏุฑุจุงุฑู ุจุงุฒ ูุงูุง ุฑุง ุงูุฌุง ุงุฏ ุจฺฏุฑุฏ</p>
                        <div id="adminTutorialControls" style="display: none;" class="mt-6">
                            <button onclick="showTutorialManagement()" class="bg-yellow-600 hover:bg-yellow-700 px-6 py-3 rounded-lg font-bold transition-colors text-lg border-2 border-yellow-500">
                                โ๏ธ ูุฏุฑุช ุขููุฒุดโูุง
                            </button>
                        </div>
                    </div>
                    <!-- Tutorial Management Panel -->
                    <div id="tutorialManagementPanel" style="display: none;" class="mb-8 bg-gray-800 p-6 rounded-lg border-2 border-yellow-500">
                        <h3 class="text-2xl font-bold mb-6 text-yellow-400">โ๏ธ ูุฏุฑุช ุขููุฒุดโูุง</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Add Tutorial -->
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <h4 class="text-lg font-bold mb-4 text-green-400">โ ุงูุฒูุฏู ุขููุฒุด</h4>
                                <div class="space-y-3">
                                    <input type="text" id="newTutorialTitle" placeholder="ุนููุงู ุขููุฒุด ุฌุฏุฏ" 
                                           class="w-full p-3 rounded-lg bg-gray-600 text-white border border-gray-500 focus:border-green-500 transition-colors">
                                    <textarea id="newTutorialText" rows="3" placeholder="ูุชู ุขููุฒุด" 
                                              class="w-full p-3 rounded-lg bg-gray-600 text-white border border-gray-500 focus:border-green-500 transition-colors"></textarea>
                                    <button onclick="addNewTutorial()" class="w-full bg-green-600 hover:bg-green-700 p-3 rounded-lg font-bold transition-colors">
                                        โ ุงูุฒูุฏู ุขููุฒุด
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Delete Tutorial -->
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <h4 class="text-lg font-bold mb-4 text-red-400">๐๏ธ ุญุฐู ุขููุฒุด</h4>
                                <div class="space-y-3">
                                    <select id="tutorialToDelete" class="w-full p-3 rounded-lg bg-gray-600 text-white border border-gray-500 focus:border-red-500 transition-colors">
                                        <option value="">ุงูุชุฎุงุจ ุขููุฒุด ุจุฑุง ุญุฐู</option>
                                    </select>
                                    <button onclick="deleteSelectedTutorial()" class="w-full bg-red-600 hover:bg-red-700 p-3 rounded-lg font-bold transition-colors">
                                        ๐๏ธ ุญุฐู ุขููุฒุด
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <button onclick="hideTutorialManagement()" class="bg-gray-600 hover:bg-gray-700 px-6 py-2 rounded-lg font-bold transition-colors">
                                โ ุจุณุชู
                            </button>
                        </div>
                    </div>
                    
                    <div id="tutorialContent">
                        <div class="space-y-6">
                            <div class="bg-gray-800 p-6 rounded-lg border-l-4 border-yellow-500">
                                <h3 class="text-2xl font-bold mb-4 text-yellow-400">๐ฏ ููุงูู ุงุตู</h3>
                                <p class="text-lg leading-relaxed">ุจุงุฒ ูุงูุง ฺฉ ุจุงุฒ ฺฏุฑูู ุงุณุช ฺฉู ุฏุฑ ุขู ุดูุฑููุฏุงู ุณุน ูโฺฉููุฏ ูุงูุงูุง ุฑุง ูพุฏุง ฺฉููุฏ ู ุขููุง ุฑุง ุงุฒ ุดูุฑ ุงุฎุฑุงุฌ ฺฉููุฏ. ูุฏู ูุงูุงูุง ูุฒ ุญุฐู ุชูุงู ุดูุฑููุฏุงู ุงุณุช.</p>
                            </div>
                            <div class="bg-gray-800 p-6 rounded-lg border-l-4 border-green-500">
                                <h3 class="text-2xl font-bold mb-4 text-green-400">๐ฅ ููุดโูุง</h3>
                                <p class="text-lg leading-relaxed">ูุฑ ุจุงุฒฺฉู ููุด ุฏุงุฑุฏ: ุดูุฑููุฏ ุนุงุฏุ ูุงูุงุ ฺฉุงุฑุขฺฏุงูุ ุฏฺฉุชุฑุ ูฺฏูุจุงู ู ููุดโูุง ูฺู ุฏฺฏุฑ. ูุฑ ููุด ูุฏุฑุช ู ูุธุงู ุฎุงุต ุฎูุฏ ุฑุง ุฏุงุฑุฏ.</p>
                            </div>
                            <div class="bg-gray-800 p-6 rounded-lg border-l-4 border-purple-500">
                                <h3 class="text-2xl font-bold mb-4 text-purple-400">๐ ูุฑุงุญู ุจุงุฒ</h3>
                                <p class="text-lg leading-relaxed">ุจุงุฒ ุดุงูู ุฏู ูุฑุญูู ุดุจ ู ุฑูุฒ ุงุณุช. ุฏุฑ ุดุจ ูุงูุงูุง ุนูู ูโฺฉููุฏ ู ุฏุฑ ุฑูุฒ ููู ุจุงุฒฺฉูุงู ุจุฑุง ุฑุง ุฏุงุฏู ู ุงุฎุฑุงุฌ ูุธููู ุฌูุน ูโุดููุฏ.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scenarios Section -->
            <div id="scenariosSection" class="section hidden">
                <div class="bg-black bg-opacity-90 p-8 rounded-xl border border-green-500">
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-green-400 mb-4">๐ฒ ุณูุงุฑููุง ุจุงุฒ</h2>
                        <p class="text-lg text-gray-300">ุณูุงุฑููุง ูุฎุชูู ุจุฑุง ุชุฌุฑุจูโุง ูุชููุน</p>
                    </div>
                    <div id="scenarioContent">
                        <div class="grid gap-6">
                            <div class="bg-gray-800 p-6 rounded-lg border border-red-400">
                                <h3 class="text-2xl font-bold mb-4 text-red-400">๐๏ธ ุณูุงุฑู ฺฉูุงุณฺฉ</h3>
                                <p class="text-lg leading-relaxed">ุณูุงุฑู ุงุณุชุงูุฏุงุฑุฏ ุจุง ููุดโูุง ุงุตู ูุงูุงุ ุดูุฑููุฏุ ฺฉุงุฑุขฺฏุงู ู ุฏฺฉุชุฑ. ููุงุณุจ ุจุฑุง ูุจุชุฏุงู.</p>
                            </div>
                            <div class="bg-gray-800 p-6 rounded-lg border border-blue-400">
                                <h3 class="text-2xl font-bold mb-4 text-blue-400">๐ญ ุณูุงุฑู ูพุดุฑูุชู</h3>
                                <p class="text-lg leading-relaxed">ุดุงูู ููุดโูุง ูฺู ูุงููุฏ ุฑูุงููพุฒุดฺฉุ ูุงุถุ ุดูุฑุฏุงุฑ ู... ุจุฑุง ุจุงุฒฺฉูุงู ุจุง ุชุฌุฑุจู.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Groups Section -->
            <div id="groupsSection" class="section hidden">
                <div class="bg-black bg-opacity-90 p-8 rounded-xl border border-purple-500">
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-purple-400 mb-4">๐ฅ ฺฏุฑููโูุง ูุงูุง ุชุงู</h2>
                        <p class="text-lg text-gray-300">ุจู ฺฏุฑููโูุง ูุฎุชูู ุจูพููุฏุฏ ู ุจุง ุฏฺฏุฑุงู ุจุงุฒ ฺฉูุฏ</p>
                        <div id="adminGroupControls" style="display: none;" class="mt-6">
                            <button onclick="showGroupManagement()" class="bg-yellow-600 hover:bg-yellow-700 px-6 py-3 rounded-lg font-bold transition-colors text-lg border-2 border-yellow-500">
                                โ๏ธ ูุฏุฑุช ฺฏุฑููโูุง
                            </button>
                        </div>
                    </div>
                    
                    <!-- Group Management Panel -->
                    <div id="groupManagementPanel" style="display: none;" class="mb-8 bg-gray-800 p-6 rounded-lg border-2 border-yellow-500">
                        <h3 class="text-2xl font-bold mb-6 text-yellow-400">โ๏ธ ูุฏุฑุช ฺฏุฑููโูุง</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Add Group -->
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <h4 class="text-lg font-bold mb-4 text-green-400">โ ุงูุฒูุฏู ฺฏุฑูู</h4>
                                <div class="space-y-3">
                                    <input type="text" id="newGroupName" placeholder="ูุงู ฺฏุฑูู ุฌุฏุฏ" 
                                           class="w-full p-3 rounded-lg bg-gray-600 text-white border border-gray-500 focus:border-green-500 transition-colors">
                                    <button onclick="addNewGroup()" class="w-full bg-green-600 hover:bg-green-700 p-3 rounded-lg font-bold transition-colors">
                                        โ ุงูุฒูุฏู ฺฏุฑูู
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Delete Group -->
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <h4 class="text-lg font-bold mb-4 text-red-400">๐๏ธ ุญุฐู ฺฏุฑูู</h4>
                                <div class="space-y-3">
                                    <select id="groupToDelete" class="w-full p-3 rounded-lg bg-gray-600 text-white border border-gray-500 focus:border-red-500 transition-colors">
                                        <option value="">ุงูุชุฎุงุจ ฺฏุฑูู ุจุฑุง ุญุฐู</option>
                                    </select>
                                    <button onclick="deleteSelectedGroup()" class="w-full bg-red-600 hover:bg-red-700 p-3 rounded-lg font-bold transition-colors">
                                        ๐๏ธ ุญุฐู ฺฏุฑูู
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <button onclick="hideGroupManagement()" class="bg-gray-600 hover:bg-gray-700 px-6 py-2 rounded-lg font-bold transition-colors">
                                โ ุจุณุชู
                            </button>
                        </div>
                    </div>
                    
                    <div id="groupContent">
                        <div class="grid gap-6">
                            <div class="bg-gray-800 p-6 rounded-lg border border-green-400">
                                <h3 class="text-2xl font-bold mb-4 text-green-400">๐ฑ ฺฏุฑูู ูุจุชุฏุงู</h3>
                                <p class="text-lg leading-relaxed">ุจุฑุง ุชุงุฒูโฺฉุงุฑุงู ุจุงุฒ ูุงูุง. ูุญุท ุฏูุณุชุงูู ุจุฑุง ุงุฏฺฏุฑ.</p>
                            </div>
                            <div class="bg-gray-800 p-6 rounded-lg border border-orange-400">
                                <h3 class="text-2xl font-bold mb-4 text-orange-400">๐ฅ ฺฏุฑูู ุญุฑููโุงโูุง</h3>
                                <p class="text-lg leading-relaxed">ุจุฑุง ุจุงุฒฺฉูุงู ุจุง ุชุฌุฑุจู ฺฉู ุจู ุฏูุจุงู ฺุงูุดโูุง ุฌุฏ ูุณุชูุฏ.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanelSection" class="section hidden">
                <div class="bg-black bg-opacity-90 p-8 rounded-xl border-2 border-yellow-500">
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-yellow-400 mb-4">โ๏ธ ูพูู ูุฏุฑุช</h2>
                        <p class="text-lg text-gray-300">ูุฏุฑุช ฺฉุงูู ูุญุชูุง ุณุงุช</p>
                    </div>
                    
                    <div class="grid lg:grid-cols-3 gap-6">
                        <!-- Content Management -->
                        <div class="bg-gray-800 p-6 rounded-lg border border-blue-400">
                            <h3 class="text-2xl font-bold mb-6 text-blue-400">๐ ูุฏุฑุช ูุญุชูุง</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-lg font-bold mb-2 text-gray-300">ุนููุงู:</label>
                                    <input type="text" id="contentTitle" 
                                           class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors"
                                           placeholder="ุนููุงู ูุญุชูุง ุฑุง ูุงุฑุฏ ฺฉูุฏ">
                                </div>
                                <div>
                                    <label class="block text-lg font-bold mb-2 text-gray-300">ูุชู:</label>
                                    <textarea id="contentText" rows="3" 
                                              class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors"
                                              placeholder="ูุชู ูุญุชูุง ุฑุง ูุงุฑุฏ ฺฉูุฏ"></textarea>
                                </div>
                                <div>
                                    <label class="block text-lg font-bold mb-2 text-gray-300">URL ุชุตูุฑ:</label>
                                    <input type="url" id="contentImage" 
                                           class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors"
                                           placeholder="ููฺฉ ุชุตูุฑ (ุงุฎุชุงุฑ)">
                                </div>
                                <div>
                                    <label class="block text-lg font-bold mb-2 text-gray-300">ููุน ูุญุชูุง:</label>
                                    <select id="contentType" onchange="toggleContentFields()" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors">
                                        <option value="tutorial">ุขููุฒุด</option>
                                        <option value="scenario">ุณูุงุฑู</option>
                                        <option value="group">ฺฏุฑูู</option>
                                        <option value="site">ูุญุชูุง ุณุงุช</option>
                                    </select>
                                </div>
                                <div id="tutorialFields" style="display: none;">
                                    <label class="block text-lg font-bold mb-2 text-gray-300">ูุชู ุชูุตู ุขููุฒุด:</label>
                                    <textarea id="tutorialDetails" rows="3" 
                                              class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors"
                                              placeholder="ุชูุถุญุงุช ุชูุตู ุขููุฒุด ุฑุง ูุงุฑุฏ ฺฉูุฏ"></textarea>
                                </div>
                                <div id="groupFields" style="display: none;">
                                    <label class="block text-lg font-bold mb-2 text-gray-300">ุงุนุถุง ฺฏุฑูู (ุจุง ฺฉุงูุง ุฌุฏุง ฺฉูุฏ):</label>
                                    <input type="text" id="groupMembers" 
                                           class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors"
                                           placeholder="ูุซุงู: ุนู, ุณุงุฑุง, ูุญูุฏ">
                                </div>
                                <div id="siteFields" style="display: none;">
                                    <label class="block text-lg font-bold mb-2 text-gray-300">ููุน ูุญุชูุง ุณุงุช:</label>
                                    <select id="siteContentType" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-blue-500 transition-colors">
                                        <option value="news">ุงุฎุจุงุฑ</option>
                                        <option value="announcement">ุงุทูุงุนู</option>
                                        <option value="event">ุฑูุฏุงุฏ</option>
                                        <option value="update">ุจุฑูุฒุฑุณุงู</option>
                                    </select>
                                </div>
                                <button onclick="addContent()" 
                                        class="w-full bg-green-600 hover:bg-green-700 p-3 rounded-lg font-bold transition-colors text-lg">
                                    โ ุงูุฒูุฏู ูุญุชูุง
                                </button>
                            </div>
                        </div>

                        <!-- User Management -->
                        <div class="bg-gray-800 p-6 rounded-lg border border-green-400">
                            <h3 class="text-2xl font-bold mb-6 text-green-400">๐ฅ ูุฏุฑุช ฺฉุงุฑุจุฑุงู</h3>
                            
                            <!-- Add New User -->
                            <div class="mb-6 bg-gray-700 p-4 rounded-lg border border-blue-400">
                                <h4 class="text-lg font-bold mb-3 text-blue-400">โ ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุฌุฏุฏ</h4>
                                <div class="flex space-x-2 space-x-reverse">
                                    <input type="text" id="addUserName" placeholder="ูุงู ฺฉุงุฑุจุฑ ุฌุฏุฏ" 
                                           class="flex-1 p-3 rounded-lg bg-gray-600 text-white border border-gray-500 focus:border-blue-500 transition-colors">
                                    <button onclick="addUserBack()" class="bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg font-bold transition-colors whitespace-nowrap">
                                        โ ุงุฌุงุฏ ฺฉุงุฑุจุฑ
                                    </button>
                                </div>
                                <p class="text-xs text-gray-400 mt-2">ุฑูุฒ ุนุจูุฑ ูพุดโูุฑุถ: password123</p>
                            </div>
                            
                            <!-- All Users -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold mb-3 text-green-400">๐ฅ ููู ฺฉุงุฑุจุฑุงู</h4>
                                <div id="usersList" class="space-y-3 max-h-64 overflow-y-auto">
                                    <!-- Users will be displayed here -->
                                </div>
                            </div>
                            
                            <!-- Info Section -->
                            <div>
                                <h4 class="text-lg font-bold mb-3 text-yellow-400">โน๏ธ ุงุทูุงุนุงุช</h4>
                                <div id="removedUsersList" class="space-y-3 max-h-64 overflow-y-auto">
                                    <!-- Info will be displayed here -->
                                </div>
                            </div>
                        </div>

                        <!-- IP Tracking -->
                        <div class="bg-gray-800 p-6 rounded-lg border border-purple-400">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-2xl font-bold text-purple-400">๐ IP ูุง ุขููุงู</h3>
                                <button onclick="clearAllIPs()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">
                                    ๐๏ธ ูพุงฺฉ ฺฉุฑุฏู ููู
                                </button>
                            </div>
                            <div id="onlineIPsList" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Online IPs will be displayed here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Content Management Actions -->
                    <div class="mt-8 bg-gray-800 p-6 rounded-lg border border-red-400">
                        <h3 class="text-2xl font-bold mb-6 text-red-400">๐๏ธ ุญุฐู ูุญุชูุง</h3>
                        <div class="grid md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-lg font-bold mb-2 text-gray-300">ุญุฐู ุขููุฒุด:</label>
                                <select id="deleteTutorialSelect" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-red-500 transition-colors mb-2">
                                    <option value="">ุงูุชุฎุงุจ ุขููุฒุด ุจุฑุง ุญุฐู</option>
                                </select>
                                <button onclick="deleteSelectedContent('tutorials')" class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-lg font-bold transition-colors text-sm">
                                    ๐๏ธ ุญุฐู ุขููุฒุด
                                </button>
                            </div>
                            <div>
                                <label class="block text-lg font-bold mb-2 text-gray-300">ุญุฐู ุณูุงุฑู:</label>
                                <select id="deleteScenarioSelect" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-red-500 transition-colors mb-2">
                                    <option value="">ุงูุชุฎุงุจ ุณูุงุฑู ุจุฑุง ุญุฐู</option>
                                </select>
                                <button onclick="deleteSelectedContent('scenarios')" class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-lg font-bold transition-colors text-sm">
                                    ๐๏ธ ุญุฐู ุณูุงุฑู
                                </button>
                            </div>
                            <div>
                                <label class="block text-lg font-bold mb-2 text-gray-300">ุญุฐู ฺฏุฑูู:</label>
                                <select id="deleteGroupSelect" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-red-500 transition-colors mb-2">
                                    <option value="">ุงูุชุฎุงุจ ฺฏุฑูู ุจุฑุง ุญุฐู</option>
                                </select>
                                <button onclick="deleteSelectedContent('groups')" class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-lg font-bold transition-colors text-sm">
                                    ๐๏ธ ุญุฐู ฺฏุฑูู
                                </button>
                            </div>
                            <div>
                                <label class="block text-lg font-bold mb-2 text-gray-300">ุญุฐู ูุญุชูุง ุณุงุช:</label>
                                <select id="deleteSiteContentSelect" class="w-full p-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-red-500 transition-colors mb-2">
                                    <option value="">ุงูุชุฎุงุจ ูุญุชูุง ุจุฑุง ุญุฐู</option>
                                </select>
                                <button onclick="deleteSelectedContent('siteContent')" class="w-full bg-red-600 hover:bg-red-700 p-2 rounded-lg font-bold transition-colors text-sm">
                                    ๐๏ธ ุญุฐู ูุญุชูุง ุณุงุช
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Back Button -->
        <button id="backBtn" onclick="showSection('home')" 
                class="fixed bottom-6 left-6 bg-gray-800 hover:bg-gray-700 p-4 rounded-full shadow-lg transition-all duration-300 hover:scale-110"
                style="display: none;">
            โฉ๏ธ
        </button>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('carnivalUsers') || '{}');
        let content = JSON.parse(localStorage.getItem('carnivalContent') || '{"tutorials":[],"scenarios":[],"groups":[],"siteContent":[]}');
        let onlineUsers = JSON.parse(localStorage.getItem('carnivalOnlineUsers') || '{}');
        let userIP = null;
        
        // Get user IP and track online status
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
            } catch (error) {
                userIP = 'Unknown_' + Math.random().toString(36).substr(2, 9);
            }
            
            // Track this IP as online
            onlineUsers[userIP] = {
                timestamp: Date.now(),
                userAgent: navigator.userAgent,
                isActive: true
            };
            localStorage.setItem('carnivalOnlineUsers', JSON.stringify(onlineUsers));
            updateOnlineUsersDisplay();
        }
        
        // Update online users display
        function updateOnlineUsersDisplay() {
            const now = Date.now();
            const fiveMinutesAgo = now - (5 * 60 * 1000); // 5 minutes
            
            // Remove inactive users (older than 5 minutes)
            Object.keys(onlineUsers).forEach(ip => {
                if (onlineUsers[ip].timestamp < fiveMinutesAgo) {
                    delete onlineUsers[ip];
                }
            });
            
            localStorage.setItem('carnivalOnlineUsers', JSON.stringify(onlineUsers));
            
            // Update display for admin
            if (currentUser && currentUser.isAdmin) {
                updateAdminOnlineUsersDisplay();
            }
        }
        
        // Keep user active
        function keepUserActive() {
            if (userIP) {
                onlineUsers[userIP] = {
                    ...onlineUsers[userIP],
                    timestamp: Date.now(),
                    isActive: true
                };
                localStorage.setItem('carnivalOnlineUsers', JSON.stringify(onlineUsers));
            }
        }
        
        // Real-time content update checker
        function checkForContentUpdates() {
            const newContent = JSON.parse(localStorage.getItem('carnivalContent') || '{"tutorials":[],"scenarios":[],"groups":[],"siteContent":[]}');
            const newAbout = JSON.parse(localStorage.getItem('carnivalAbout') || '{}');
            const newUsers = JSON.parse(localStorage.getItem('carnivalUsers') || '{}');
            
            // Check if content has changed
            if (JSON.stringify(content) !== JSON.stringify(newContent)) {
                const oldContentString = JSON.stringify(content);
                content = newContent;
                
                // Reload all content displays
                loadContent();
                loadHomeContent();
                updateDeleteLists();
                
                // Show notification to non-admin users
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification('๐ ูุญุชูุง ุณุงุช ุจุฑูุฒุฑุณุงู ุดุฏ!');
                }
                
                // Check what type of change occurred
                const oldContent = JSON.parse(oldContentString);
                checkSpecificContentChanges(oldContent, newContent);
            }
            
            // Check if about section has changed
            const currentAbout = JSON.parse(localStorage.getItem('carnivalAbout') || '{}');
            if (JSON.stringify(newAbout) !== JSON.stringify(currentAbout)) {
                loadAboutSection();
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification('๐ ุจุฎุด ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู ุจุฑูุฒุฑุณุงู ุดุฏ!');
                }
            }
            
            // Check if users list has changed
            if (JSON.stringify(users) !== JSON.stringify(newUsers)) {
                users = newUsers;
                updateUsersList();
            }
        }
        
        // Check specific content changes and notify users
        function checkSpecificContentChanges(oldContent, newContent) {
            // Check for new tutorials
            if (newContent.tutorials.length > oldContent.tutorials.length) {
                const newTutorial = newContent.tutorials[newContent.tutorials.length - 1];
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification(`๐ ุขููุฒุด ุฌุฏุฏ: ${newTutorial.title}`);
                }
            }
            
            // Check for new scenarios
            if (newContent.scenarios.length > oldContent.scenarios.length) {
                const newScenario = newContent.scenarios[newContent.scenarios.length - 1];
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification(`๐ฒ ุณูุงุฑู ุฌุฏุฏ: ${newScenario.title}`);
                }
            }
            
            // Check for new groups
            if (newContent.groups.length > oldContent.groups.length) {
                const newGroup = newContent.groups[newContent.groups.length - 1];
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification(`๐ฅ ฺฏุฑูู ุฌุฏุฏ: ${newGroup.title}`);
                }
            }
            
            // Check for new site content
            if (newContent.siteContent.length > oldContent.siteContent.length) {
                const newSiteContent = newContent.siteContent[newContent.siteContent.length - 1];
                if (!currentUser || !currentUser.isAdmin) {
                    const typeText = {
                        'news': 'ุฎุจุฑ',
                        'announcement': 'ุงุทูุงุนู', 
                        'event': 'ุฑูุฏุงุฏ',
                        'update': 'ุจุฑูุฒุฑุณุงู'
                    }[newSiteContent.siteType] || 'ูุญุชูุง';
                    showContentUpdateNotification(`๐ฅ ${typeText} ุฌุฏุฏ: ${newSiteContent.title}`);
                }
            }
            
            // Check for content deletions
            if (newContent.tutorials.length < oldContent.tutorials.length) {
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification('๐๏ธ ฺฉ ุขููุฒุด ุญุฐู ุดุฏ');
                }
            }
            
            if (newContent.scenarios.length < oldContent.scenarios.length) {
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification('๐๏ธ ฺฉ ุณูุงุฑู ุญุฐู ุดุฏ');
                }
            }
            
            if (newContent.groups.length < oldContent.groups.length) {
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification('๐๏ธ ฺฉ ฺฏุฑูู ุญุฐู ุดุฏ');
                }
            }
            
            if (newContent.siteContent.length < oldContent.siteContent.length) {
                if (!currentUser || !currentUser.isAdmin) {
                    showContentUpdateNotification('๐๏ธ ฺฉ ูุญุชูุง ุญุฐู ุดุฏ');
                }
            }
        }
        
        // Show content update notification
        function showContentUpdateNotification(message = 'ูุญุชูุง ุฌุฏุฏ ุงุถุงูู ุดุฏ!', type = 'update') {
            // Remove existing notifications first
            const existingNotifications = document.querySelectorAll('.live-notification');
            existingNotifications.forEach(notif => {
                if (document.body.contains(notif)) {
                    document.body.removeChild(notif);
                }
            });
            
            const notification = document.createElement('div');
            const bgColor = type === 'delete' ? 'bg-red-600' : type === 'edit' ? 'bg-blue-600' : 'bg-green-600';
            const icon = type === 'delete' ? '๐๏ธ' : type === 'edit' ? 'โ๏ธ' : '๐';
            
            notification.className = `live-notification fixed top-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300 border-2 border-white`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3 space-x-reverse">
                    <span class="text-2xl animate-pulse">${icon}</span>
                    <div>
                        <div class="font-bold text-lg">${message}</div>
                        <div class="text-sm opacity-90">ุจุฑูุฒุฑุณุงู ุขููุงู</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-300 text-xl font-bold ml-2">ร</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Slide in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto slide out and remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
            
            // Add click sound effect (visual feedback)
            notification.addEventListener('click', () => {
                notification.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    notification.style.transform = 'scale(1)';
                }, 100);
            });
        }
        
        // Toggle content fields based on type
        function toggleContentFields() {
            const contentType = document.getElementById('contentType').value;
            const tutorialFields = document.getElementById('tutorialFields');
            const groupFields = document.getElementById('groupFields');
            const siteFields = document.getElementById('siteFields');
            
            tutorialFields.style.display = contentType === 'tutorial' ? 'block' : 'none';
            groupFields.style.display = contentType === 'group' ? 'block' : 'none';
            siteFields.style.display = contentType === 'site' ? 'block' : 'none';
        }
        
        // Get color for site content types
        function getSiteContentColor(siteType) {
            const colors = {
                'news': 'blue',
                'announcement': 'yellow',
                'event': 'green',
                'update': 'purple'
            };
            return colors[siteType] || 'blue';
        }
        
        // Get icon for site content types
        function getSiteContentIcon(siteType) {
            const icons = {
                'news': '๐ฐ',
                'announcement': '๐ข',
                'event': '๐',
                'update': '๐'
            };
            return icons[siteType] || '๐ฐ';
        }
        
        // Initialize admin user
        if (!users['amir990']) {
            users['amir990'] = {
                password: 'amir',
                gameName: 'amir',
                isAdmin: true,
                loginTime: null
            };
            localStorage.setItem('carnivalUsers', JSON.stringify(users));
        }

        // Menu functionality
        document.getElementById('menuBtn').addEventListener('click', () => {
            document.getElementById('sideMenu').classList.add('open');
        });

        document.getElementById('closeMenu').addEventListener('click', () => {
            document.getElementById('sideMenu').classList.remove('open');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('sideMenu');
            const menuBtn = document.getElementById('menuBtn');
            if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
                menu.classList.remove('open');
            }
        });

        // Section navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            document.getElementById('sideMenu').classList.remove('open');
            
            // Show/hide back button
            const backBtn = document.getElementById('backBtn');
            if (sectionName === 'home') {
                backBtn.style.display = 'none';
            } else {
                backBtn.style.display = 'block';
            }
        }

        // Login functionality
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const gameName = document.getElementById('gameName').value.trim();
            const messageDiv = document.getElementById('loginMessage');

            if (!username || !password || !gameName) {
                messageDiv.innerHTML = '<p class="text-red-500 font-bold">ูุทูุงู ุชูุงู ููุฏูุง ุฑุง ูพุฑ ฺฉูุฏ!</p>';
                return;
            }

            // Check if game name is already taken by another user
            const existingUser = Object.entries(users).find(([key, user]) => 
                user.gameName === gameName && key !== username
            );

            if (existingUser) {
                messageDiv.innerHTML = '<p class="text-red-500 font-bold">โ ุงู ูุงู ุฏุฑ ุจุงุฒ ูุจูุงู ุชูุณุท ฺฉุงุฑุจุฑ ุฏฺฏุฑ ุงุณุชูุงุฏู ุดุฏู ุงุณุช!</p>';
                return;
            }

            if (users[username]) {
                // Existing user login
                if (users[username].password === password) {
                    users[username].gameName = gameName;
                    users[username].loginTime = new Date().toISOString();
                    currentUser = { username, ...users[username] };
                    localStorage.setItem('carnivalUsers', JSON.stringify(users));
                    
                    messageDiv.innerHTML = '<p class="text-green-500 font-bold">โ ูุฑูุฏ ููููุชโุขูุฒ!</p>';
                    
                    if (currentUser.isAdmin) {
                        document.getElementById('adminMenuItems').style.display = 'block';
                        document.getElementById('adminGroupControls').style.display = 'block';
                        document.getElementById('adminTutorialControls').style.display = 'block';
                        document.getElementById('adminAboutControls').style.display = 'block';
                        updateAdminOnlineUsersDisplay();
                        updateDeleteLists();
                    }
                    document.getElementById('logoutBtn').style.display = 'block';
                    
                    setTimeout(() => showSection('home'), 1500);
                } else {
                    messageDiv.innerHTML = '<p class="text-red-500 font-bold">โ ุฑูุฒ ุนุจูุฑ ุงุดุชุจุงู ุงุณุช!</p>';
                }
            } else {
                // New user registration
                users[username] = {
                    password: password,
                    gameName: gameName,
                    isAdmin: false,
                    loginTime: new Date().toISOString()
                };
                currentUser = { username, ...users[username] };
                localStorage.setItem('carnivalUsers', JSON.stringify(users));
                
                messageDiv.innerHTML = '<p class="text-green-500 font-bold">โ ุญุณุงุจ ุฌุฏุฏ ุจุง ููููุช ุงุฌุงุฏ ุดุฏ!</p>';
                document.getElementById('logoutBtn').style.display = 'block';
                
                setTimeout(() => showSection('home'), 1500);
            }
            
            updateUsersList();
        }

        // Logout functionality
        function logout() {
            if (currentUser) {
                users[currentUser.username].loginTime = null;
                localStorage.setItem('carnivalUsers', JSON.stringify(users));
            }
            
            currentUser = null;
            document.getElementById('adminMenuItems').style.display = 'none';
            document.getElementById('adminGroupControls').style.display = 'none';
            document.getElementById('adminTutorialControls').style.display = 'none';
            document.getElementById('adminAboutControls').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('loginMessage').innerHTML = '';
            showSection('home');
            updateUsersList();
        }

        // Admin content management
        function addContent() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ูุญุชูุง ุงุถุงูู ฺฉูุฏ!');
                return;
            }

            const title = document.getElementById('contentTitle').value.trim();
            const text = document.getElementById('contentText').value.trim();
            const image = document.getElementById('contentImage').value.trim();
            const type = document.getElementById('contentType').value;

            if (!title || !text) {
                alert('โ ูุทูุงู ุนููุงู ู ูุชู ุฑุง ูพุฑ ฺฉูุฏ!');
                return;
            }

            const newContent = {
                id: Date.now(),
                title: title,
                text: text,
                image: image,
                createdAt: new Date().toISOString(),
                addedBy: currentUser.gameName
            };

            // Add specific fields based on content type
            if (type === 'tutorial') {
                const details = document.getElementById('tutorialDetails').value.trim();
                if (details) {
                    newContent.details = details;
                }
            } else if (type === 'group') {
                const members = document.getElementById('groupMembers').value.trim();
                if (members) {
                    newContent.members = members.split(',').map(member => member.trim()).filter(member => member);
                }
            } else if (type === 'site') {
                const siteContentType = document.getElementById('siteContentType').value;
                newContent.siteType = siteContentType;
                newContent.color = getSiteContentColor(siteContentType);
            }

            const contentKey = type === 'site' ? 'siteContent' : type + 's';
            content[contentKey].push(newContent);
            localStorage.setItem('carnivalContent', JSON.stringify(content));

            // Clear form
            document.getElementById('contentTitle').value = '';
            document.getElementById('contentText').value = '';
            document.getElementById('contentImage').value = '';
            document.getElementById('tutorialDetails').value = '';
            document.getElementById('groupMembers').value = '';
            document.getElementById('siteContentType').value = 'news';

            // Refresh content display and delete lists
            loadContent();
            loadHomeContent();
            updateDeleteLists();
            
            // Show success notification to admin and redirect to home
            showAdminNotification('โ ูุญุชูุง ุจุง ููููุช ุงุถุงูู ุดุฏ! ุฏุฑ ุญุงู ุงูุชูุงู ุจู ุตูุญู ุงุตู...', 'success');
            
            // Redirect to home page after 2 seconds to show the new content
            setTimeout(() => {
                showSection('home');
                // Scroll to the new content area
                const homeContentDisplay = document.getElementById('homeContentDisplay');
                if (homeContentDisplay) {
                    homeContentDisplay.scrollIntoView({ behavior: 'smooth' });
                }
            }, 2000);
            
            // Trigger live update for all users
            triggerLiveUpdate('add', type, newContent);
        }
        
        // Trigger live update for all users
        function triggerLiveUpdate(action, contentType, contentData) {
            // Store the update info for other users to see
            const updateInfo = {
                action: action,
                contentType: contentType,
                contentData: contentData,
                timestamp: Date.now(),
                adminName: currentUser ? currentUser.gameName : 'ุงุฏูู'
            };
            
            // Store in localStorage for other tabs/users to detect
            let liveUpdates = JSON.parse(localStorage.getItem('carnivalLiveUpdates') || '[]');
            liveUpdates.push(updateInfo);
            
            // Keep only last 10 updates
            if (liveUpdates.length > 10) {
                liveUpdates = liveUpdates.slice(-10);
            }
            
            localStorage.setItem('carnivalLiveUpdates', JSON.stringify(liveUpdates));
        }
        
        // Check for live updates from admin
        function checkForLiveUpdates() {
            if (currentUser && currentUser.isAdmin) return; // Admin doesn't need to see their own updates
            
            const liveUpdates = JSON.parse(localStorage.getItem('carnivalLiveUpdates') || '[]');
            const lastChecked = localStorage.getItem('carnivalLastUpdateCheck') || '0';
            const lastCheckedTime = parseInt(lastChecked);
            
            // Find new updates since last check
            const newUpdates = liveUpdates.filter(update => update.timestamp > lastCheckedTime);
            
            if (newUpdates.length > 0) {
                // Update last checked time
                const latestUpdate = Math.max(...newUpdates.map(update => update.timestamp));
                localStorage.setItem('carnivalLastUpdateCheck', latestUpdate.toString());
                
                // Show notifications for new updates
                newUpdates.forEach(update => {
                    showLiveUpdateNotification(update);
                });
            }
        }
        
        // Show live update notification
        function showLiveUpdateNotification(updateInfo) {
            const { action, contentType, contentData, adminName } = updateInfo;
            
            let message = '';
            let type = 'update';
            
            if (action === 'add') {
                const typeText = {
                    'tutorial': 'ุขููุฒุด',
                    'scenario': 'ุณูุงุฑู', 
                    'group': 'ฺฏุฑูู',
                    'site': 'ูุญุชูุง ุณุงุช'
                }[contentType] || 'ูุญุชูุง';
                
                message = `${adminName} ${typeText} ุฌุฏุฏ ุงุถุงูู ฺฉุฑุฏ: "${contentData.title}"`;
                type = 'update';
            } else if (action === 'delete') {
                const typeText = {
                    'tutorials': 'ุขููุฒุด',
                    'scenarios': 'ุณูุงุฑู',
                    'groups': 'ฺฏุฑูู', 
                    'siteContent': 'ูุญุชูุง ุณุงุช'
                }[contentType] || 'ูุญุชูุง';
                
                message = `${adminName} ฺฉ ${typeText} ุฑุง ุญุฐู ฺฉุฑุฏ`;
                type = 'delete';
            } else if (action === 'edit') {
                message = `${adminName} ูุญุชูุง ุฑุง ูุฑุงุด ฺฉุฑุฏ: "${contentData.title}"`;
                type = 'edit';
            }
            
            if (message) {
                showContentUpdateNotification(message, type);
            }
        }
        
        // Update delete lists
        function updateDeleteLists() {
            if (!currentUser || !currentUser.isAdmin) return;
            
            // Update tutorials delete list (only admin's tutorials)
            const tutorialSelect = document.getElementById('deleteTutorialSelect');
            if (tutorialSelect) {
                tutorialSelect.innerHTML = '<option value="">ุงูุชุฎุงุจ ุขููุฒุด ุจุฑุง ุญุฐู</option>';
                const adminTutorials = content.tutorials.filter(tutorial => {
                    return tutorial.id && !tutorial.id.toString().startsWith('default') && (
                        tutorial.addedBy === currentUser.gameName || 
                        tutorial.editedBy === currentUser.gameName || 
                        tutorial.createdBy === currentUser.gameName ||
                        !tutorial.addedBy // For backward compatibility
                    );
                });
                
                if (adminTutorials.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'ูฺ ุขููุฒุด ูุงุจู ุญุฐู ูุฌูุฏ ูุฏุงุฑุฏ';
                    option.disabled = true;
                    tutorialSelect.appendChild(option);
                } else {
                    adminTutorials.forEach(tutorial => {
                        const option = document.createElement('option');
                        option.value = tutorial.id;
                        option.textContent = tutorial.title.replace(/๐ฏ|๐ฅ|๐|๐/g, '').trim() + 
                            (tutorial.addedBy ? ` (ุชูุณุท ${tutorial.addedBy})` : '');
                        tutorialSelect.appendChild(option);
                    });
                }
            }
            
            // Update scenarios delete list (only admin's scenarios)
            const scenarioSelect = document.getElementById('deleteScenarioSelect');
            if (scenarioSelect) {
                scenarioSelect.innerHTML = '<option value="">ุงูุชุฎุงุจ ุณูุงุฑู ุจุฑุง ุญุฐู</option>';
                const adminScenarios = content.scenarios.filter(scenario => {
                    return scenario.id && !scenario.id.toString().startsWith('default') && (
                        scenario.addedBy === currentUser.gameName || 
                        scenario.editedBy === currentUser.gameName || 
                        scenario.createdBy === currentUser.gameName ||
                        !scenario.addedBy // For backward compatibility
                    );
                });
                
                if (adminScenarios.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'ูฺ ุณูุงุฑู ูุงุจู ุญุฐู ูุฌูุฏ ูุฏุงุฑุฏ';
                    option.disabled = true;
                    scenarioSelect.appendChild(option);
                } else {
                    adminScenarios.forEach(scenario => {
                        const option = document.createElement('option');
                        option.value = scenario.id;
                        option.textContent = scenario.title.replace(/๐๏ธ|๐ญ/g, '').trim() + 
                            (scenario.addedBy ? ` (ุชูุณุท ${scenario.addedBy})` : '');
                        scenarioSelect.appendChild(option);
                    });
                }
            }
            
            // Update groups delete list (only admin's groups)
            const groupSelect = document.getElementById('deleteGroupSelect');
            if (groupSelect) {
                groupSelect.innerHTML = '<option value="">ุงูุชุฎุงุจ ฺฏุฑูู ุจุฑุง ุญุฐู</option>';
                const adminGroups = content.groups.filter(group => {
                    return group.id && !group.id.toString().startsWith('default') && (
                        group.addedBy === currentUser.gameName || 
                        group.editedBy === currentUser.gameName || 
                        group.createdBy === currentUser.gameName ||
                        !group.addedBy // For backward compatibility
                    );
                });
                
                if (adminGroups.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'ูฺ ฺฏุฑูู ูุงุจู ุญุฐู ูุฌูุฏ ูุฏุงุฑุฏ';
                    option.disabled = true;
                    groupSelect.appendChild(option);
                } else {
                    adminGroups.forEach(group => {
                        const option = document.createElement('option');
                        option.value = group.id;
                        option.textContent = group.title.replace(/๐ฅ|๐ฑ|๐ฅ|โญ/g, '').trim() + 
                            (group.addedBy ? ` (ุชูุณุท ${group.addedBy})` : '');
                        groupSelect.appendChild(option);
                    });
                }
            }
            
            // Update site content delete list (only admin's site content)
            const siteContentSelect = document.getElementById('deleteSiteContentSelect');
            if (siteContentSelect) {
                siteContentSelect.innerHTML = '<option value="">ุงูุชุฎุงุจ ูุญุชูุง ุจุฑุง ุญุฐู</option>';
                const adminSiteContent = content.siteContent.filter(siteItem => {
                    return siteItem.addedBy === currentUser.gameName || 
                           siteItem.editedBy === currentUser.gameName || 
                           siteItem.createdBy === currentUser.gameName ||
                           !siteItem.addedBy; // For backward compatibility
                });
                
                if (adminSiteContent.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'ูฺ ูุญุชูุง ุณุงุช ูุงุจู ุญุฐู ูุฌูุฏ ูุฏุงุฑุฏ';
                    option.disabled = true;
                    siteContentSelect.appendChild(option);
                } else {
                    adminSiteContent.forEach(siteItem => {
                        const option = document.createElement('option');
                        option.value = siteItem.id;
                        option.textContent = siteItem.title + 
                            (siteItem.addedBy ? ` (ุชูุณุท ${siteItem.addedBy})` : '');
                        siteContentSelect.appendChild(option);
                    });
                }
            }
        }
        
        // Delete selected content
        function deleteSelectedContent(contentType) {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ูุญุชูุง ุญุฐู ฺฉูุฏ!');
                return;
            }
            
            let selectId;
            let contentTypeText;
            switch(contentType) {
                case 'tutorials':
                    selectId = 'deleteTutorialSelect';
                    contentTypeText = 'ุขููุฒุด';
                    break;
                case 'scenarios':
                    selectId = 'deleteScenarioSelect';
                    contentTypeText = 'ุณูุงุฑู';
                    break;
                case 'groups':
                    selectId = 'deleteGroupSelect';
                    contentTypeText = 'ฺฏุฑูู';
                    break;
                case 'siteContent':
                    selectId = 'deleteSiteContentSelect';
                    contentTypeText = 'ูุญุชูุง ุณุงุช';
                    break;
                default:
                    return;
            }
            
            const selectedId = document.getElementById(selectId).value;
            if (!selectedId) {
                alert(`โ ูุทูุงู ${contentTypeText} ุจุฑุง ุญุฐู ุงูุชุฎุงุจ ฺฉูุฏ!`);
                return;
            }
            
            // Check if it's a default item (prevent deletion for non-site content)
            if (contentType !== 'siteContent' && selectedId.toString().startsWith('default')) {
                alert(`โ ููโุชูุงูุฏ ${contentTypeText} ูพุดโูุฑุถ ุฑุง ุญุฐู ฺฉูุฏ!`);
                return;
            }
            
            const itemToDelete = content[contentType].find(item => item.id == selectedId);
            if (!itemToDelete) {
                alert(`โ ${contentTypeText} ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ!`);
                return;
            }
            
            // Check if this content was added/edited by admin
            const isAdminContent = itemToDelete.addedBy === currentUser.gameName || 
                                 itemToDelete.editedBy === currentUser.gameName || 
                                 itemToDelete.createdBy === currentUser.gameName ||
                                 !itemToDelete.id.toString().startsWith('default');
            
            if (!isAdminContent && contentType !== 'siteContent') {
                alert(`โ ุดูุง ููุท ูโุชูุงูุฏ ${contentTypeText}ูุง ฺฉู ุฎูุฏุชุงู ุงุถุงูู ุง ูุฑุงุด ฺฉุฑุฏูโุงุฏ ุฑุง ุญุฐู ฺฉูุฏ!`);
                return;
            }
            
            if (confirm(`ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ${contentTypeText} "${itemToDelete.title}" ุฑุง ุญุฐู ฺฉูุฏุ\n\nโ๏ธ ุงู ุนูู ุบุฑูุงุจู ุจุงุฒฺฏุดุช ุงุณุช!`)) {
                content[contentType] = content[contentType].filter(item => item.id != selectedId);
                localStorage.setItem('carnivalContent', JSON.stringify(content));
                
                // Reset select
                document.getElementById(selectId).value = '';
                
                // Refresh displays
                loadContent();
                loadHomeContent();
                updateDeleteLists();
                
                // Show success message
                alert(`โ ${contentTypeText} "${itemToDelete.title}" ุจุง ููููุช ุญุฐู ุดุฏ!`);
                showAdminNotification(`โ ${contentTypeText} ุจุง ููููุช ุญุฐู ุดุฏ!`, 'success');
                
                // Trigger live update for all users
                triggerLiveUpdate('delete', contentType, itemToDelete);
            }
        }
        
        // Clear all IPs
        function clearAllIPs() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ IP ูุง ุฑุง ูพุงฺฉ ฺฉูุฏ!');
                return;
            }
            
            if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุชูุงู IP ูุง ุขููุงู ุฑุง ูพุงฺฉ ฺฉูุฏุ')) {
                onlineUsers = {};
                localStorage.setItem('carnivalOnlineUsers', JSON.stringify(onlineUsers));
                updateAdminOnlineUsersDisplay();
                showAdminNotification('โ ุชูุงู IP ูุง ูพุงฺฉ ุดุฏูุฏ!', 'success');
            }
        }
        
        // Show admin notification
        function showAdminNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600';
            
            notification.className = `fixed top-4 left-4 ${bgColor} text-white p-4 rounded-lg shadow-lg z-50 transform -translate-x-full transition-transform duration-300`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span class="font-bold">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Slide in
            setTimeout(() => {
                notification.classList.remove('-translate-x-full');
            }, 100);
            
            // Slide out and remove
            setTimeout(() => {
                notification.classList.add('-translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Load and display content
        function loadContent() {
            // Load tutorials
            const tutorialDiv = document.getElementById('tutorialContent');
            let tutorialHTML = '<div class="space-y-6">';
            
            // Default tutorials
            const defaultTutorials = [
                {
                    id: 'default1',
                    title: '๐ฏ ููุงูู ุงุตู',
                    text: 'ุจุงุฒ ูุงูุง ฺฉ ุจุงุฒ ฺฏุฑูู ุงุณุช ฺฉู ุฏุฑ ุขู ุดูุฑููุฏุงู ุณุน ูโฺฉููุฏ ูุงูุงูุง ุฑุง ูพุฏุง ฺฉููุฏ ู ุขููุง ุฑุง ุงุฒ ุดูุฑ ุงุฎุฑุงุฌ ฺฉููุฏ. ูุฏู ูุงูุงูุง ูุฒ ุญุฐู ุชูุงู ุดูุฑููุฏุงู ุงุณุช.',
                    image: '',
                    color: 'yellow'
                },
                {
                    id: 'default2',
                    title: '๐ฅ ููุดโูุง',
                    text: 'ูุฑ ุจุงุฒฺฉู ููุด ุฏุงุฑุฏ: ุดูุฑููุฏ ุนุงุฏุ ูุงูุงุ ฺฉุงุฑุขฺฏุงูุ ุฏฺฉุชุฑุ ูฺฏูุจุงู ู ููุดโูุง ูฺู ุฏฺฏุฑ. ูุฑ ููุด ูุฏุฑุช ู ูุธุงู ุฎุงุต ุฎูุฏ ุฑุง ุฏุงุฑุฏ.',
                    image: '',
                    color: 'green'
                },
                {
                    id: 'default3',
                    title: '๐ ูุฑุงุญู ุจุงุฒ',
                    text: 'ุจุงุฒ ุดุงูู ุฏู ูุฑุญูู ุดุจ ู ุฑูุฒ ุงุณุช. ุฏุฑ ุดุจ ูุงูุงูุง ุนูู ูโฺฉููุฏ ู ุฏุฑ ุฑูุฒ ููู ุจุงุฒฺฉูุงู ุจุฑุง ุฑุง ุฏุงุฏู ู ุงุฎุฑุงุฌ ูุธููู ุฌูุน ูโุดููุฏ.',
                    image: '',
                    color: 'purple'
                }
            ];

            // Filter out overridden defaults and merge with custom content
            const allTutorials = [...defaultTutorials, ...content.tutorials];
            const filteredTutorials = allTutorials.filter(tutorial => {
                // If it's a custom content that overrides a default, hide the default
                if (tutorial.id && tutorial.id.startsWith('default')) {
                    const isOverridden = content.tutorials.some(custom => custom.overrideDefault === tutorial.id);
                    return !isOverridden;
                }
                return true;
            });

            filteredTutorials.forEach(tutorial => {
                const color = tutorial.color || 'blue';
                const safeTitle = tutorial.title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const safeText = tutorial.text.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                // Add detailed text if available
                const detailsHTML = tutorial.details ? `
                    <div class="mt-4 p-4 bg-gray-700 rounded-lg border-r-4 border-${color}-400">
                        <h4 class="text-lg font-bold mb-3 text-${color}-300">๐ ุชูุถุญุงุช ุชูุตู:</h4>
                        <p class="text-base leading-relaxed text-gray-300">${tutorial.details}</p>
                    </div>
                ` : '';
                
                tutorialHTML += `
                    <div class="bg-gray-800 p-6 rounded-lg border-l-4 border-${color}-500">
                        ${tutorial.image ? `<img src="${tutorial.image}" alt="${tutorial.title}" class="w-full h-48 object-cover rounded-lg mb-4">` : ''}
                        <h3 class="text-2xl font-bold mb-4 text-${color}-400">${tutorial.title}</h3>
                        <p class="text-lg leading-relaxed">${tutorial.text}</p>
                        ${detailsHTML}
                        ${currentUser && currentUser.isAdmin ? `
                            <div class="mt-4 space-x-2 space-x-reverse">
                                <button onclick="editContent('tutorials', '${tutorial.id}', '${safeTitle}', '${safeText}', '${tutorial.image || ''}', '${tutorial.color || 'blue'}')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">โ๏ธ ูุฑุงุด</button>
                                ${!tutorial.id || !tutorial.id.toString().startsWith('default') ? `<button onclick="deleteContent('tutorials', '${tutorial.id}')" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">๐๏ธ ุญุฐู</button>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            tutorialHTML += '</div>';
            tutorialDiv.innerHTML = tutorialHTML;

            // Load scenarios
            const scenarioDiv = document.getElementById('scenarioContent');
            let scenarioHTML = '<div class="grid gap-6">';
            
            const defaultScenarios = [
                {
                    id: 'default1',
                    title: '๐๏ธ ุณูุงุฑู ฺฉูุงุณฺฉ',
                    text: 'ุณูุงุฑู ุงุณุชุงูุฏุงุฑุฏ ุจุง ููุดโูุง ุงุตู ูุงูุงุ ุดูุฑููุฏุ ฺฉุงุฑุขฺฏุงู ู ุฏฺฉุชุฑ. ููุงุณุจ ุจุฑุง ูุจุชุฏุงู.',
                    image: '',
                    color: 'red'
                },
                {
                    id: 'default2',
                    title: '๐ญ ุณูุงุฑู ูพุดุฑูุชู',
                    text: 'ุดุงูู ููุดโูุง ูฺู ูุงููุฏ ุฑูุงููพุฒุดฺฉุ ูุงุถุ ุดูุฑุฏุงุฑ ู... ุจุฑุง ุจุงุฒฺฉูุงู ุจุง ุชุฌุฑุจู.',
                    image: '',
                    color: 'blue'
                }
            ];

            [...defaultScenarios, ...content.scenarios].forEach(scenario => {
                const color = scenario.color || 'green';
                scenarioHTML += `
                    <div class="bg-gray-800 p-6 rounded-lg border border-${color}-400">
                        ${scenario.image ? `<img src="${scenario.image}" alt="${scenario.title}" class="w-full h-48 object-cover rounded-lg mb-4">` : ''}
                        <h3 class="text-2xl font-bold mb-4 text-${color}-400">${scenario.title}</h3>
                        <p class="text-lg leading-relaxed">${scenario.text}</p>
                        ${currentUser && currentUser.isAdmin ? `
                            <div class="mt-4 space-x-2 space-x-reverse">
                                <button onclick="editContent('scenarios', '${scenario.id}', '${scenario.title.replace(/'/g, "\\'")}', '${scenario.text.replace(/'/g, "\\'")}', '${scenario.image || ''}', '${scenario.color || 'green'}')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">โ๏ธ ูุฑุงุด</button>
                                ${!scenario.id || !scenario.id.toString().startsWith('default') ? `<button onclick="deleteContent('scenarios', '${scenario.id}')" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">๐๏ธ ุญุฐู</button>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            scenarioHTML += '</div>';
            scenarioDiv.innerHTML = scenarioHTML;

            // Load groups
            const groupDiv = document.getElementById('groupContent');
            let groupHTML = '<div class="grid gap-6">';
            
            const defaultGroups = [
                {
                    id: 'default1',
                    title: '๐ฑ ฺฏุฑูู ูุจุชุฏุงู',
                    text: 'ุจุฑุง ุชุงุฒูโฺฉุงุฑุงู ุจุงุฒ ูุงูุง. ูุญุท ุฏูุณุชุงูู ุจุฑุง ุงุฏฺฏุฑ.',
                    image: '',
                    color: 'green'
                },
                {
                    id: 'default2',
                    title: '๐ฅ ฺฏุฑูู ุญุฑููโุงโูุง',
                    text: 'ุจุฑุง ุจุงุฒฺฉูุงู ุจุง ุชุฌุฑุจู ฺฉู ุจู ุฏูุจุงู ฺุงูุดโูุง ุฌุฏ ูุณุชูุฏ.',
                    image: '',
                    color: 'orange'
                }
            ];

            // Filter out overridden defaults and merge with custom content
            const allGroups = [...defaultGroups, ...content.groups];
            const filteredGroups = allGroups.filter(group => {
                // If it's a custom content that overrides a default, hide the default
                if (group.id && group.id.startsWith('default')) {
                    const isOverridden = content.groups.some(custom => custom.overrideDefault === group.id);
                    return !isOverridden;
                }
                return true;
            });

            filteredGroups.forEach(group => {
                const color = group.color || 'purple';
                const safeTitle = group.title.replace(/'/g, "\\'").replace(/"/g, '\\"');
                const safeText = group.text.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                // Display members if available
                const membersHTML = group.members && group.members.length > 0 ? `
                    <div class="mt-4 p-4 bg-gray-700 rounded-lg border-r-4 border-${color}-400">
                        <h4 class="text-lg font-bold mb-3 text-${color}-300">๐ฅ ุงุนุถุง ฺฏุฑูู:</h4>
                        <div class="flex flex-wrap gap-2">
                            ${group.members.map(member => `
                                <span class="bg-${color}-600 text-white px-3 py-1 rounded-full text-sm font-semibold">${member}</span>
                            `).join('')}
                        </div>
                    </div>
                ` : '';
                
                groupHTML += `
                    <div class="bg-gray-800 p-6 rounded-lg border border-${color}-400">
                        ${group.image ? `<img src="${group.image}" alt="${group.title}" class="w-full h-48 object-cover rounded-lg mb-4">` : ''}
                        <h3 class="text-2xl font-bold mb-4 text-${color}-400">${group.title}</h3>
                        <p class="text-lg leading-relaxed">${group.text}</p>
                        ${membersHTML}
                        ${currentUser && currentUser.isAdmin ? `
                            <div class="mt-4 space-x-2 space-x-reverse">
                                <button onclick="editContent('groups', '${group.id}', '${safeTitle}', '${safeText}', '${group.image || ''}', '${group.color || 'purple'}')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">โ๏ธ ูุฑุงุด</button>
                                ${!group.id || !group.id.toString().startsWith('default') ? `<button onclick="deleteContent('groups', '${group.id}')" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-sm font-bold transition-colors">๐๏ธ ุญุฐู</button>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            groupHTML += '</div>';
            groupDiv.innerHTML = groupHTML;
        }

        // Edit content
        function editContent(type, id, title, text, image, color) {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ูุญุชูุง ูุฑุงุด ฺฉูุฏ!');
                return;
            }

            // Fill the form with current values
            document.getElementById('contentTitle').value = title;
            document.getElementById('contentText').value = text;
            document.getElementById('contentImage').value = image;
            document.getElementById('contentType').value = type.slice(0, -1); // Remove 's' from end

            // Toggle fields based on content type
            toggleContentFields();

            // Fill specific fields if editing existing content
            const contentArray = content[type];
            const existingContent = contentArray.find(item => item.id == id);
            if (existingContent) {
                if (existingContent.details) {
                    document.getElementById('tutorialDetails').value = existingContent.details;
                }
                if (existingContent.members) {
                    document.getElementById('groupMembers').value = existingContent.members.join(', ');
                }
            }

            // Store edit info for update
            window.editingContent = { type, id };

            // Change button text and function
            const addButton = document.querySelector('#adminPanelSection button[onclick="addContent()"]');
            addButton.innerHTML = 'โ๏ธ ุจุฑูุฒุฑุณุงู ูุญุชูุง';
            addButton.setAttribute('onclick', 'updateContent()');

            // Show admin panel
            showSection('adminPanel');
            
            // Scroll to form
            document.getElementById('contentTitle').scrollIntoView({ behavior: 'smooth' });
        }

        // Update content
        function updateContent() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ูุญุชูุง ุจุฑูุฒุฑุณุงู ฺฉูุฏ!');
                return;
            }

            const title = document.getElementById('contentTitle').value.trim();
            const text = document.getElementById('contentText').value.trim();
            const image = document.getElementById('contentImage').value.trim();
            const contentType = document.getElementById('contentType').value;

            if (!title || !text) {
                alert('โ ูุทูุงู ุนููุงู ู ูุชู ุฑุง ูพุฑ ฺฉูุฏ!');
                return;
            }

            const { type, id } = window.editingContent;
            let updatedContent = null;

            // Check if it's a default item (update in place)
            if (id.startsWith('default')) {
                // For default items, we need to handle them specially
                // We'll create a new item to override the default
                const newContent = {
                    id: Date.now(),
                    title: title,
                    text: text,
                    image: image,
                    overrideDefault: id,
                    createdAt: new Date().toISOString(),
                    editedBy: currentUser.gameName
                };

                // Add specific fields based on content type
                if (contentType === 'tutorial') {
                    const details = document.getElementById('tutorialDetails').value.trim();
                    if (details) {
                        newContent.details = details;
                    }
                } else if (contentType === 'group') {
                    const members = document.getElementById('groupMembers').value.trim();
                    if (members) {
                        newContent.members = members.split(',').map(member => member.trim()).filter(member => member);
                    }
                }

                content[type].push(newContent);
                updatedContent = newContent;
            } else {
                // Update existing custom content
                const itemIndex = content[type].findIndex(item => item.id == id);
                if (itemIndex !== -1) {
                    content[type][itemIndex] = {
                        ...content[type][itemIndex],
                        title: title,
                        text: text,
                        image: image,
                        updatedAt: new Date().toISOString(),
                        editedBy: currentUser.gameName
                    };

                    // Update specific fields based on content type
                    if (contentType === 'tutorial') {
                        const details = document.getElementById('tutorialDetails').value.trim();
                        content[type][itemIndex].details = details;
                    } else if (contentType === 'group') {
                        const members = document.getElementById('groupMembers').value.trim();
                        content[type][itemIndex].members = members ? members.split(',').map(member => member.trim()).filter(member => member) : [];
                    }
                    
                    updatedContent = content[type][itemIndex];
                }
            }

            localStorage.setItem('carnivalContent', JSON.stringify(content));

            // Reset form and button
            document.getElementById('contentTitle').value = '';
            document.getElementById('contentText').value = '';
            document.getElementById('contentImage').value = '';
            document.getElementById('tutorialDetails').value = '';
            document.getElementById('groupMembers').value = '';
            
            const addButton = document.querySelector('#adminPanelSection button[onclick="updateContent()"]');
            addButton.innerHTML = 'โ ุงูุฒูุฏู ูุญุชูุง';
            addButton.setAttribute('onclick', 'addContent()');

            delete window.editingContent;

            // Refresh content display
            loadContent();
            loadHomeContent();
            alert('โ ูุญุชูุง ุจุง ููููุช ุจุฑูุฒุฑุณุงู ุดุฏ!');
            
            // Trigger live update for all users
            if (updatedContent) {
                triggerLiveUpdate('edit', contentType, updatedContent);
            }
        }

        // Delete content
        function deleteContent(type, id) {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ูุญุชูุง ุญุฐู ฺฉูุฏ!');
                return;
            }

            const itemToDelete = content[type].find(item => item.id == id);
            if (!itemToDelete) {
                alert('โ ูุญุชูุง ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ!');
                return;
            }

            if (confirm(`ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ "${itemToDelete.title}" ุฑุง ุญุฐู ฺฉูุฏุ`)) {
                content[type] = content[type].filter(item => item.id != id);
                localStorage.setItem('carnivalContent', JSON.stringify(content));
                
                // Refresh all displays
                loadContent();
                loadHomeContent();
                updateDeleteLists();
                
                alert(`โ "${itemToDelete.title}" ุจุง ููููุช ุญุฐู ุดุฏ!`);
                showAdminNotification(`โ ูุญุชูุง ุจุง ููููุช ุญุฐู ุดุฏ!`, 'success');
                
                // Trigger live update for all users
                triggerLiveUpdate('delete', type, itemToDelete);
            }
        }

        // Update users list in admin panel
        function updateUsersList() {
            const usersList = document.getElementById('usersList');
            const removedUsersList = document.getElementById('removedUsersList');
            if (!usersList) return;

            // Get all users (since we no longer use isRemoved flag)
            const allUsers = Object.entries(users);
            const loggedInUsers = allUsers.filter(([username, user]) => user.loginTime);
            const offlineUsers = allUsers.filter(([username, user]) => !user.loginTime);
            
            let usersHTML = '';
            
            // Show logged in users
            if (loggedInUsers.length > 0) {
                usersHTML += loggedInUsers.map(([username, user]) => `
                    <div class="bg-gray-700 p-4 rounded-lg border-r-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-green-400 text-xl">๐ข</span> 
                                <span class="font-bold text-lg">${user.gameName}</span>
                                <span class="text-gray-400">(${username})</span>
                                ${user.isAdmin ? '<span class="text-yellow-400 text-xl">๐</span>' : ''}
                                <span class="text-green-400 text-sm">ุขููุงู</span>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <div class="text-sm text-gray-400">
                                    ${new Date(user.loginTime).toLocaleString('fa-IR')}
                                </div>
                                ${!user.isAdmin ? `
                                    <button onclick="removeUser('${username}')" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-bold transition-colors">
                                        ๐๏ธ ุญุฐู ฺฉุงูู
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Show offline users
            if (offlineUsers.length > 0) {
                usersHTML += offlineUsers.map(([username, user]) => `
                    <div class="bg-gray-700 p-4 rounded-lg border-r-4 border-gray-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-400 text-xl">โซ</span> 
                                <span class="font-bold text-lg text-gray-300">${user.gameName}</span>
                                <span class="text-gray-500">(${username})</span>
                                ${user.isAdmin ? '<span class="text-yellow-400 text-xl">๐</span>' : ''}
                                <span class="text-gray-500 text-sm">ุขููุงู</span>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <div class="text-sm text-gray-500">
                                    ${user.createdAt ? `ุงุฌุงุฏ ุดุฏู: ${new Date(user.createdAt).toLocaleDateString('fa-IR')}` : 'ุชุงุฑุฎ ูุงูุดุฎุต'}
                                </div>
                                ${!user.isAdmin ? `
                                    <button onclick="removeUser('${username}')" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-bold transition-colors">
                                        ๐๏ธ ุญุฐู ฺฉุงูู
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            if (usersHTML) {
                usersList.innerHTML = usersHTML;
            } else {
                usersList.innerHTML = '<div class="text-center p-4"><p class="text-gray-400 text-lg">๐ค ูฺ ฺฉุงุฑุจุฑ ูุฌูุฏ ูุฏุงุฑุฏ</p></div>';
            }
            
            // Hide removed users section since we don't use it anymore
            if (removedUsersList) {
                removedUsersList.innerHTML = '<div class="text-center p-4"><p class="text-gray-400 text-lg">๐๏ธ ฺฉุงุฑุจุฑุงู ุญุฐู ุดุฏู ฺฉุงููุงู ูพุงฺฉ ูโุดููุฏ</p></div>';
            }
        }
        
        // Remove user function
        function removeUser(username) {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ฺฉุงุฑุจุฑุงู ุฑุง ุญุฐู ฺฉูุฏ!');
                return;
            }
            
            if (username === 'amir990') {
                alert('โ ููโุชูุงูุฏ ุงุฏูู ุงุตู ุฑุง ุญุฐู ฺฉูุฏ!');
                return;
            }
            
            const userToRemove = users[username];
            if (!userToRemove) {
                alert('โ ฺฉุงุฑุจุฑ ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ!');
                return;
            }
            
            if (confirm(`ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ฺฉุงุฑุจุฑ "${userToRemove.gameName}" ุฑุง ฺฉุงููุงู ุงุฒ ุณุงุช ุญุฐู ฺฉูุฏุ\n\nโ๏ธ ุงู ุนูู ุบุฑูุงุจู ุจุงุฒฺฏุดุช ุงุณุช ู ฺฉุงุฑุจุฑ ุฏฺฏุฑ ููโุชูุงูุฏ ูุงุฑุฏ ุณุงุช ุดูุฏ!`)) {
                // Completely delete user from users object
                delete users[username];
                localStorage.setItem('carnivalUsers', JSON.stringify(users));
                
                // Remove user's IP from online users if exists
                Object.keys(onlineUsers).forEach(ip => {
                    if (onlineUsers[ip].username === username) {
                        delete onlineUsers[ip];
                    }
                });
                localStorage.setItem('carnivalOnlineUsers', JSON.stringify(onlineUsers));
                
                // If the removed user is currently logged in, force logout
                if (currentUser && currentUser.username === username) {
                    alert('โ๏ธ ุญุณุงุจ ฺฉุงุฑุจุฑ ุดูุง ุชูุณุท ุงุฏูู ุญุฐู ุดุฏู ุงุณุช. ุฏุฑ ุญุงู ุฎุฑูุฌ ุงุฒ ุณุณุชู...');
                    setTimeout(() => {
                        logout();
                        location.reload(); // Reload page to ensure complete logout
                    }, 2000);
                    return;
                }
                
                updateUsersList();
                updateAdminOnlineUsersDisplay();
                alert(`โ ฺฉุงุฑุจุฑ "${userToRemove.gameName}" ฺฉุงููุงู ุงุฒ ุณุงุช ุญุฐู ุดุฏ!`);
                showAdminNotification(`โ ฺฉุงุฑุจุฑ "${userToRemove.gameName}" ฺฉุงููุงู ุญุฐู ุดุฏ!`, 'success');
            }
        }
        
        // Add user back function
        function addUserBack() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ฺฉุงุฑุจุฑุงู ุฑุง ุงุถุงูู ฺฉูุฏ!');
                return;
            }
            
            const username = document.getElementById('addUserName').value.trim();
            if (!username) {
                alert('โ ูุทูุงู ูุงู ฺฉุงุฑุจุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ!');
                return;
            }
            
            // Check if user already exists
            if (users[username]) {
                alert('โ ฺฉุงุฑุจุฑ ุจุง ุงู ูุงู ฺฉุงุฑุจุฑ ูุจูุงู ูุฌูุฏ ุฏุงุฑุฏ!');
                return;
            }
            
            // Create new user with default password
            const defaultPassword = 'password123';
            users[username] = {
                password: defaultPassword,
                gameName: username, // Use username as default game name
                isAdmin: false,
                loginTime: null,
                createdAt: new Date().toISOString(),
                createdBy: currentUser.gameName
            };
            
            localStorage.setItem('carnivalUsers', JSON.stringify(users));
            
            document.getElementById('addUserName').value = '';
            updateUsersList();
            
            alert(`โ ฺฉุงุฑุจุฑ ุฌุฏุฏ "${username}" ุจุง ููููุช ุงุถุงูู ุดุฏ!\nุฑูุฒ ุนุจูุฑ ูพุดโูุฑุถ: ${defaultPassword}\nูุงู ุฏุฑ ุจุงุฒ: ${username}`);
            showAdminNotification(`โ ฺฉุงุฑุจุฑ ุฌุฏุฏ "${username}" ุงุถุงูู ุดุฏ!`, 'success');
        }
        
        // Update admin online users display (IP tracking)
        function updateAdminOnlineUsersDisplay() {
            const onlineUsersDiv = document.getElementById('onlineIPsList');
            if (!onlineUsersDiv) return;
            
            const activeIPs = Object.entries(onlineUsers);
            
            if (activeIPs.length > 0) {
                onlineUsersDiv.innerHTML = activeIPs.map(([ip, data]) => {
                    const timeAgo = Math.floor((Date.now() - data.timestamp) / 1000 / 60);
                    const deviceInfo = getDeviceInfo(data.userAgent);
                    
                    return `
                        <div class="bg-gray-700 p-4 rounded-lg border-r-4 border-blue-500">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <span class="text-blue-400 text-xl">๐</span>
                                    <span class="font-bold text-lg text-blue-300">${ip}</span>
                                    <span class="text-green-400 text-sm">โ ุขููุงู</span>
                                </div>
                                <button onclick="kickIP('${ip}')" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-bold transition-colors">
                                    ๐ซ ุงุฎุฑุงุฌ
                                </button>
                            </div>
                            <div class="text-sm text-gray-400">
                                <div>๐ฑ ${deviceInfo}</div>
                                <div>โฐ ${timeAgo} ุฏููู ูพุด ูุนุงู</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                onlineUsersDiv.innerHTML = '<div class="text-center p-8"><p class="text-gray-400 text-lg">๐ ูฺ IP ุขููุงู ูุฌูุฏ ูุฏุงุฑุฏ</p></div>';
            }
        }
        
        // Get device info from user agent
        function getDeviceInfo(userAgent) {
            if (userAgent.includes('Mobile')) return 'ููุจุงู';
            if (userAgent.includes('Tablet')) return 'ุชุจูุช';
            if (userAgent.includes('Windows')) return 'ููุฏูุฒ';
            if (userAgent.includes('Mac')) return 'ูฺฉ';
            if (userAgent.includes('Linux')) return 'ูููฺฉุณ';
            return 'ูุงูุดุฎุต';
        }
        
        // Kick IP (admin command)
        function kickIP(ip) {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ฺฉุงุฑุจุฑุงู ุฑุง ุงุฎุฑุงุฌ ฺฉูุฏ!');
                return;
            }
            
            if (confirm(`ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ IP ${ip} ุฑุง ุงุฎุฑุงุฌ ฺฉูุฏุ`)) {
                delete onlineUsers[ip];
                localStorage.setItem('carnivalOnlineUsers', JSON.stringify(onlineUsers));
                
                // Add to blocked IPs
                let blockedIPs = JSON.parse(localStorage.getItem('carnivalBlockedIPs') || '[]');
                if (!blockedIPs.includes(ip)) {
                    blockedIPs.push(ip);
                    localStorage.setItem('carnivalBlockedIPs', JSON.stringify(blockedIPs));
                }
                
                updateAdminOnlineUsersDisplay();
                alert(`โ IP ${ip} ุจุง ููููุช ุงุฎุฑุงุฌ ุดุฏ!`);
            }
        }

        // Tutorial management functions
        function showTutorialManagement() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ุขููุฒุดโูุง ุฑุง ูุฏุฑุช ฺฉูุฏ!');
                return;
            }
            
            document.getElementById('tutorialManagementPanel').style.display = 'block';
            updateTutorialDeleteList();
        }

        function hideTutorialManagement() {
            document.getElementById('tutorialManagementPanel').style.display = 'none';
            document.getElementById('newTutorialTitle').value = '';
            document.getElementById('newTutorialText').value = '';
            document.getElementById('tutorialToDelete').value = '';
        }

        function addNewTutorial() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ุขููุฒุด ุงุถุงูู ฺฉูุฏ!');
                return;
            }

            const title = document.getElementById('newTutorialTitle').value.trim();
            const text = document.getElementById('newTutorialText').value.trim();
            
            if (!title || !text) {
                alert('โ ูุทูุงู ุนููุงู ู ูุชู ุขููุฒุด ุฑุง ูุงุฑุฏ ฺฉูุฏ!');
                return;
            }

            const newTutorial = {
                id: Date.now(),
                title: title,
                text: text,
                image: '',
                color: 'blue',
                createdAt: new Date().toISOString()
            };

            content.tutorials.push(newTutorial);
            localStorage.setItem('carnivalContent', JSON.stringify(content));
            
            document.getElementById('newTutorialTitle').value = '';
            document.getElementById('newTutorialText').value = '';
            loadContent();
            loadHomeContent();
            updateTutorialDeleteList();
            alert('โ ุขููุฒุด ุฌุฏุฏ ุจุง ููููุช ุงุถุงูู ุดุฏ!');
        }

        function updateTutorialDeleteList() {
            const select = document.getElementById('tutorialToDelete');
            select.innerHTML = '<option value="">ุงูุชุฎุงุจ ุขููุฒุด ุจุฑุง ุญุฐู</option>';
            
            content.tutorials.forEach(tutorial => {
                if (!tutorial.id || !tutorial.id.toString().startsWith('default')) {
                    const option = document.createElement('option');
                    option.value = tutorial.id;
                    option.textContent = tutorial.title.replace(/๐ฏ|๐ฅ|๐|๐/g, '').trim();
                    select.appendChild(option);
                }
            });
        }

        function deleteSelectedTutorial() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ุขููุฒุด ุญุฐู ฺฉูุฏ!');
                return;
            }

            const tutorialId = document.getElementById('tutorialToDelete').value;
            if (!tutorialId) {
                alert('โ ูุทูุงู ุขููุฒุด ุจุฑุง ุญุฐู ุงูุชุฎุงุจ ฺฉูุฏ!');
                return;
            }

            const tutorialToDelete = content.tutorials.find(tutorial => tutorial.id == tutorialId);
            if (!tutorialToDelete) {
                alert('โ ุขููุฒุด ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ!');
                return;
            }

            if (confirm(`ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุขููุฒุด "${tutorialToDelete.title}" ุฑุง ุญุฐู ฺฉูุฏุ`)) {
                content.tutorials = content.tutorials.filter(tutorial => tutorial.id != tutorialId);
                localStorage.setItem('carnivalContent', JSON.stringify(content));
                
                document.getElementById('tutorialToDelete').value = '';
                loadContent();
                loadHomeContent();
                updateTutorialDeleteList();
                updateDeleteLists();
                
                alert(`โ ุขููุฒุด "${tutorialToDelete.title}" ุจุง ููููุช ุญุฐู ุดุฏ!`);
                showAdminNotification(`โ ุขููุฒุด ุจุง ููููุช ุญุฐู ุดุฏ!`, 'success');
                
                // Trigger live update for all users
                triggerLiveUpdate('delete', 'tutorials', tutorialToDelete);
            }
        }

        // Group management functions
        function showGroupManagement() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ฺฏุฑููโูุง ุฑุง ูุฏุฑุช ฺฉูุฏ!');
                return;
            }
            
            document.getElementById('groupManagementPanel').style.display = 'block';
            updateGroupDeleteList();
        }

        function hideGroupManagement() {
            document.getElementById('groupManagementPanel').style.display = 'none';
            document.getElementById('newGroupName').value = '';
            document.getElementById('groupToDelete').value = '';
        }

        function addNewGroup() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ฺฏุฑูู ุงุถุงูู ฺฉูุฏ!');
                return;
            }

            const groupName = document.getElementById('newGroupName').value.trim();
            if (!groupName) {
                alert('โ ูุทูุงู ูุงู ฺฏุฑูู ุฑุง ูุงุฑุฏ ฺฉูุฏ!');
                return;
            }

            // Check if group already exists
            const existingGroup = content.groups.find(group => group.title.includes(groupName));
            if (existingGroup) {
                alert('โ ฺฏุฑูู ุจุง ุงู ูุงู ูุจูุงู ูุฌูุฏ ุฏุงุฑุฏ!');
                return;
            }

            const newGroup = {
                id: Date.now(),
                title: `๐ฅ ${groupName}`,
                text: `ฺฏุฑูู ${groupName} - ูุญุท ููุงุณุจ ุจุฑุง ุจุงุฒ ูุงูุง`,
                image: '',
                color: 'purple',
                members: [],
                createdAt: new Date().toISOString()
            };

            content.groups.push(newGroup);
            localStorage.setItem('carnivalContent', JSON.stringify(content));
            
            document.getElementById('newGroupName').value = '';
            loadContent();
            loadHomeContent();
            updateGroupDeleteList();
            alert('โ ฺฏุฑูู ุฌุฏุฏ ุจุง ููููุช ุงุถุงูู ุดุฏ!');
        }

        function updateGroupDeleteList() {
            const select = document.getElementById('groupToDelete');
            select.innerHTML = '<option value="">ุงูุชุฎุงุจ ฺฏุฑูู ุจุฑุง ุญุฐู</option>';
            
            content.groups.forEach(group => {
                if (!group.id || !group.id.toString().startsWith('default')) {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = group.title.replace(/๐ฅ|๐ฑ|๐ฅ|โญ/g, '').trim();
                    select.appendChild(option);
                }
            });
        }

        function deleteSelectedGroup() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ฺฏุฑูู ุญุฐู ฺฉูุฏ!');
                return;
            }

            const groupId = document.getElementById('groupToDelete').value;
            if (!groupId) {
                alert('โ ูุทูุงู ฺฏุฑูู ุจุฑุง ุญุฐู ุงูุชุฎุงุจ ฺฉูุฏ!');
                return;
            }

            const groupToDelete = content.groups.find(group => group.id == groupId);
            if (!groupToDelete) {
                alert('โ ฺฏุฑูู ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ!');
                return;
            }

            if (confirm(`ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ฺฏุฑูู "${groupToDelete.title}" ุฑุง ุญุฐู ฺฉูุฏุ`)) {
                content.groups = content.groups.filter(group => group.id != groupId);
                localStorage.setItem('carnivalContent', JSON.stringify(content));
                
                document.getElementById('groupToDelete').value = '';
                loadContent();
                loadHomeContent();
                updateGroupDeleteList();
                updateDeleteLists();
                
                alert(`โ ฺฏุฑูู "${groupToDelete.title}" ุจุง ููููุช ุญุฐู ุดุฏ!`);
                showAdminNotification(`โ ฺฏุฑูู ุจุง ููููุช ุญุฐู ุดุฏ!`, 'success');
                
                // Trigger live update for all users
                triggerLiveUpdate('delete', 'groups', groupToDelete);
            }
        }

        // About section management
        function editAboutSection() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู ุฑุง ูุฑุงุด ฺฉูุฏ!');
                return;
            }
            
            const aboutContent = document.getElementById('aboutContent');
            const aboutEditForm = document.getElementById('aboutEditForm');
            const aboutTextEdit = document.getElementById('aboutTextEdit');
            
            // Get current text
            const currentText = aboutContent.querySelector('p').textContent.trim();
            aboutTextEdit.value = currentText;
            
            // Show edit form, hide content
            aboutContent.style.display = 'none';
            aboutEditForm.style.display = 'block';
        }

        function saveAboutSection() {
            if (!currentUser || !currentUser.isAdmin) {
                alert('โ ููุท ุงุฏูู ูโุชูุงูุฏ ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู ุฑุง ุฐุฎุฑู ฺฉูุฏ!');
                return;
            }
            
            const aboutTextEdit = document.getElementById('aboutTextEdit');
            const newText = aboutTextEdit.value.trim();
            
            if (!newText) {
                alert('โ ูุทูุงู ูุชู ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ!');
                return;
            }
            
            // Save to localStorage
            let aboutData = JSON.parse(localStorage.getItem('carnivalAbout') || '{}');
            aboutData.text = newText;
            aboutData.updatedAt = new Date().toISOString();
            aboutData.editedBy = currentUser.gameName;
            localStorage.setItem('carnivalAbout', JSON.stringify(aboutData));
            
            // Update display
            loadAboutSection();
            cancelAboutEdit();
            alert('โ ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู ุจุง ููููุช ุจุฑูุฒุฑุณุงู ุดุฏ!');
            
            // Trigger live update for all users
            triggerLiveUpdate('edit', 'about', { title: 'ุฏุฑุจุงุฑู ฺฉุงุฑูุงูุงู', text: newText });
        }

        function cancelAboutEdit() {
            const aboutContent = document.getElementById('aboutContent');
            const aboutEditForm = document.getElementById('aboutEditForm');
            
            // Show content, hide edit form
            aboutContent.style.display = 'block';
            aboutEditForm.style.display = 'none';
        }

        function loadAboutSection() {
            const aboutData = JSON.parse(localStorage.getItem('carnivalAbout') || '{}');
            const aboutContent = document.getElementById('aboutContent');
            
            const defaultText = 'ฺฉุงุฑูุงูุงู ฺฉ ูพูุชูุฑู ุฌุงูุน ุจุฑุง ุนูุงููโููุฏุงู ุจู ุจุงุฒ ูุงูุง ุงุณุช. ุฏุฑ ุงูุฌุง ูโุชูุงูุฏ ุขููุฒุดโูุง ฺฉุงููุ ุณูุงุฑููุง ูุชููุน ู ฺฏุฑููโูุง ูุฎุชูู ุจุงุฒ ุฑุง ูพุฏุง ฺฉูุฏ. ููฺูู ุงูฺฉุงู ุฏุงูููุฏ ุจุงุฒ ูุงูุง ุชุงู ู ุงุฑุชุจุงุท ุจุง ุณุงุฑ ุจุงุฒฺฉูุงู ุฑุง ุฏุงุฑุฏ.';
            
            const textToShow = aboutData.text || defaultText;
            aboutContent.innerHTML = `<p class="text-lg leading-relaxed text-gray-300">${textToShow}</p>`;
        }

        // Load home content display
        function loadHomeContent() {
            const homeContentDisplay = document.getElementById('homeContentDisplay');
            if (!homeContentDisplay) return;
            
            let homeHTML = '';
            
            // Get latest site content first (most important)
            const latestSiteContent = content.siteContent.slice(-3); // Last 3 site content items
            
            // Site Content Section
            if (latestSiteContent.length > 0) {
                homeHTML += `
                    <div class="mb-8">
                        <div class="bg-black bg-opacity-90 p-6 rounded-xl border-2 border-red-500">
                            <h3 class="text-3xl font-bold mb-6 text-red-400 text-center">๐ฅ ุขุฎุฑู ุงุฎุจุงุฑ ู ุงุทูุงุนูโูุง</h3>
                            <div class="grid gap-4">
                `;
                
                latestSiteContent.forEach(siteItem => {
                    const color = siteItem.color || 'red';
                    const icon = getSiteContentIcon(siteItem.siteType);
                    const typeText = {
                        'news': 'ุฎุจุฑ',
                        'announcement': 'ุงุทูุงุนู',
                        'event': 'ุฑูุฏุงุฏ',
                        'update': 'ุจุฑูุฒุฑุณุงู'
                    }[siteItem.siteType] || 'ุฎุจุฑ';
                    
                    homeHTML += `
                        <div class="bg-gray-800 p-6 rounded-lg border-l-4 border-${color}-500 card-hover">
                            ${siteItem.image ? `<img src="${siteItem.image}" alt="${siteItem.title}" class="w-full h-48 object-cover rounded-lg mb-4">` : ''}
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-xl font-bold text-${color}-400">${icon} ${siteItem.title}</h4>
                                <span class="bg-${color}-600 text-white px-3 py-1 rounded-full text-sm font-bold">${typeText}</span>
                            </div>
                            <p class="text-gray-300 leading-relaxed">${siteItem.text}</p>
                            <div class="mt-4 text-sm text-gray-400">
                                ๐ ${new Date(siteItem.createdAt).toLocaleDateString('fa-IR')}
                            </div>
                        </div>
                    `;
                });
                
                homeHTML += '</div></div></div>';
            }
            
            // Get latest content from other categories
            const latestTutorials = content.tutorials.slice(-2); // Last 2 tutorials
            const latestGroups = content.groups.slice(-2); // Last 2 groups
            
            if (latestTutorials.length > 0 || latestGroups.length > 0) {
                homeHTML += '<div class="grid lg:grid-cols-2 gap-8">';
                
                // Latest Tutorials
                if (latestTutorials.length > 0) {
                    homeHTML += `
                        <div class="bg-black bg-opacity-80 p-6 rounded-xl border border-blue-500">
                            <h3 class="text-2xl font-bold mb-6 text-blue-400 text-center">๐ ุขุฎุฑู ุขููุฒุดโูุง</h3>
                            <div class="space-y-4">
                    `;
                    
                    latestTutorials.forEach(tutorial => {
                        const color = tutorial.color || 'blue';
                        homeHTML += `
                            <div class="bg-gray-800 p-4 rounded-lg border-r-4 border-${color}-400">
                                <h4 class="text-lg font-bold mb-2 text-${color}-400">${tutorial.title}</h4>
                                <p class="text-sm text-gray-300">${tutorial.text.substring(0, 100)}${tutorial.text.length > 100 ? '...' : ''}</p>
                                <button onclick="showSection('tutorials')" class="mt-2 text-${color}-400 hover:text-${color}-300 text-sm font-bold">
                                    ูุดุงูุฏู ฺฉุงูู โ
                                </button>
                            </div>
                        `;
                    });
                    
                    homeHTML += '</div></div>';
                }
                
                // Latest Groups
                if (latestGroups.length > 0) {
                    homeHTML += `
                        <div class="bg-black bg-opacity-80 p-6 rounded-xl border border-purple-500">
                            <h3 class="text-2xl font-bold mb-6 text-purple-400 text-center">๐ฅ ุขุฎุฑู ฺฏุฑููโูุง</h3>
                            <div class="space-y-4">
                    `;
                    
                    latestGroups.forEach(group => {
                        const color = group.color || 'purple';
                        homeHTML += `
                            <div class="bg-gray-800 p-4 rounded-lg border-r-4 border-${color}-400">
                                <h4 class="text-lg font-bold mb-2 text-${color}-400">${group.title}</h4>
                                <p class="text-sm text-gray-300">${group.text.substring(0, 100)}${group.text.length > 100 ? '...' : ''}</p>
                                ${group.members && group.members.length > 0 ? `
                                    <div class="mt-2 flex flex-wrap gap-1">
                                        ${group.members.slice(0, 3).map(member => `
                                            <span class="bg-${color}-600 text-white px-2 py-1 rounded-full text-xs">${member}</span>
                                        `).join('')}
                                        ${group.members.length > 3 ? `<span class="text-${color}-400 text-xs">+${group.members.length - 3} ููุฑ ุฏฺฏุฑ</span>` : ''}
                                    </div>
                                ` : ''}
                                <button onclick="showSection('groups')" class="mt-2 text-${color}-400 hover:text-${color}-300 text-sm font-bold">
                                    ูุดุงูุฏู ฺฉุงูู โ
                                </button>
                            </div>
                        `;
                    });
                    
                    homeHTML += '</div></div>';
                }
                
                homeHTML += '</div>';
            }
            
            homeContentDisplay.innerHTML = homeHTML;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Get user IP and start tracking
            await getUserIP();
            
            // Check for blocked IP
            const blockedIPs = JSON.parse(localStorage.getItem('carnivalBlockedIPs') || '[]');
            if (blockedIPs.includes(userIP)) {
                document.body.innerHTML = `
                    <div class="min-h-screen bg-red-900 flex items-center justify-center">
                        <div class="text-center text-white">
                            <h1 class="text-6xl mb-4">๐ซ</h1>
                            <h2 class="text-3xl font-bold mb-4">ุฏุณุชุฑุณ ูุณุฏูุฏ ุดุฏู</h2>
                            <p class="text-xl">IP ุดูุง ุชูุณุท ูุฏุฑ ุณุงุช ูุณุฏูุฏ ุดุฏู ุงุณุช</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            loadContent();
            loadAboutSection();
            loadHomeContent();
            updateUsersList();
            updateDeleteLists();
            showSection('home');
            
            // Real-time updates
            setInterval(() => {
                keepUserActive();
                updateOnlineUsersDisplay();
                checkForContentUpdates();
                checkForLiveUpdates();
            }, 2000); // Every 2 seconds for faster updates
            
            // Update users list every 30 seconds
            setInterval(updateUsersList, 30000);
            
            // Track user activity
            document.addEventListener('click', keepUserActive);
            document.addEventListener('scroll', keepUserActive);
            document.addEventListener('keypress', keepUserActive);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96becbf795cfcd05',t:'MTc1NDY1MzgzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
